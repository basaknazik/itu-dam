name: Ders GÃ¼ncelleme Robotu ğŸ¤–

on:
  workflow_dispatch: # Manuel "Ã‡alÄ±ÅŸtÄ±r" butonu
  # schedule:
  #  - cron: '0 */6 * * *' # Her 6 saatte bir otomatik Ã§alÄ±ÅŸ

permissions:
  contents: write # Repoya dosya kaydetme izni

jobs:
  scrape-and-build:
    runs-on: ubuntu-latest

    steps:
    - name: Depoyu Ã‡ek (Checkout)
      uses: actions/checkout@v4

    - name: Python 3.10 Kur
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'

    - name: Google Chrome Kur
      uses: browser-actions/setup-chrome@latest

    - name: Gerekli Paketleri YÃ¼kle
      run: |
        # 1. Sanal Ekran (Xvfb) paketini kur (MonitÃ¶r taklidi iÃ§in)
        sudo apt-get update
        sudo apt-get install -y xvfb
        
        # 2. Python kÃ¼tÃ¼phanelerini kur
        pip install selenium webdriver-manager beautifulsoup4 requests

    - name: Verileri Ã‡ek (Sanal Ekran Modu)
      run: |
        # xvfb-run komutu, Python kodunu sanal bir 1920x1080 ekranda Ã§alÄ±ÅŸtÄ±rÄ±r.
        # BÃ¶ylece Selenium "Ekran yok" hatasÄ± vermez ve Ä°TÃœ robot olduÄŸunu anlamaz.
        xvfb-run --auto-servernum --server-args="-screen 0 1920x1080x24" python iturequestr.py

    - name: Siteyi OluÅŸtur (Builder)
      run: python sitebuilder.py

    - name: DeÄŸiÅŸiklikleri Kaydet ve GÃ¶nder
      run: |
        git config --global user.name 'Ders Robotu'
        git config --global user.email 'actions@github.com'
        
        # JSON ve HTML dosyalarÄ±nÄ± sahneye al
        git add dersler.json index.html
        
        # DeÄŸiÅŸiklik varsa commit et, yoksa hata verme
        git commit -m "Otomatik GÃ¼ncelleme: $(date +'%Y-%m-%d %H:%M')" || exit 0
        git push